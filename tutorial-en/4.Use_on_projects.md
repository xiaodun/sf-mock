# add a new item

Open `programConfig.js` and add a new project as 'sf-notes'

````
"sf-notes": {},
````

Execute `node createFileStructure.js` in the directory where 'createFileStructure.js' is located, which will not be described later

At this point in the "data" directory, the "sf-notes" folder will be created, as well as 'sf-notes-mock-api.js' and 'sf-notes-name-map.js'

Next, just change the prefix of the request address of the project to 'http://localhost:9192/sf-notes'

# About cross-domain processing

The getHeaders method in serviceConfig.js is used to deal with cross-domain issues. `data.remoteOrigin` and `data.reqHeaders` are automatically generated by the program based on the request headers. In theory, there will be no cross-domain situation.

The configuration here can also be used to test cross-domain problems, and the server needs to be restarted after modification.

# use nginx

The above method will still make changes to the code, and it will be very troublesome for team development, switching branches, etc.

In order to facilitate processing, the mock server has a built-in nginx, and adding some configurations can make the code unchanged.

````
    "sf-notes": {
      programUrl: "http://localhost:8000",
      programPrefix: "/",
      apiPrefixList: ["/api"],
      //One item of the array represents a service on nginx
      serverList: [
        {
          //listen port
          port: 9000,
          //Forward to the mock server, the address is automatically generated by the program
          isMock: true,
        },
      ],
      webpackHotUrl,
    },

````

- programUrl is the start address of the project

- programPrefix:"/" is used for nginx to forward, that is, visit http://localhost:9000 to convert to http://localhost:8000

- apiPrefixList:["/api"] is used to forward ajax requests to the specified server, for example using http://localhost:9000/api

- serverList,port configure the listening port isMock: true means that http://localhost:9000/api will be forwarded to the mock server

- webpackHotUrl is the hot update address of the front-end project. It will be called after changing the project code and can be viewed in the network request

Execute `node writeNginxConfig.js`

Execute `start killNginx.bat` to remove all port numbers occupied by nginx

Execute `start nginx.exe`

Restart nginx every time `node writeNginxConfig.js` is executed

After configuration, you can access the project by visiting http://localhost:9000, but the ajax request will be forwarded to the mock server

The content in nginx.conf corresponding to the above configuration is as follows

````
    server {
        listen 9000;
        #WebServer
        location /api {
            proxy_pass http://10.210.2.234:9192/sf-notes/api;
            client_max_body_size 64m;
        }
        location / {
            proxy_pass http://localhost:8000;
        }
        location /sockjs-node {
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_set_header Host $host;
            proxy_pass http://127.0.0.1:8080;
            proxy_redirect off;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }
````

# configuration supplement

````
    "sf-notes": {
      withFileStructure: false,
      withNginxConfig: false,
    }

````

withFileStructure is false, execute `node createFileStructure.js` to skip this project

withNginxConfig is false, execute `node writeNginxConfig.js` to skip this project

````
 apiPrefixList: ["/api"],
 serverList: [

        {
          port: 9061,
          url: "",
          name: "Test Environment",
          autoAddPrefix: false,
        },
 ]

````

When `autoAddPrefix` is true, the forwarding address will automatically add 'api', when false it will not

# nginx common commands

Start: start nginx.exe

Update: nginx -s reload

stop: nginx -s stop